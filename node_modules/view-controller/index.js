/**
 * Created by leewoongjae on 15. 7. 6..
 */
module.exports = (function() {
    "use strict";

    var views = [];
    var Promise = require("promise");

    var pushView = function(_view) {

        var bView = (views.length > 0) ? views[views.length - 1] : undefined;
        views.push(_view);

        var promise = function () {

            return new Promise(function (resolve, reject) {

                _view.show(function () {

                    resolve("promise end");

                });

            });

        };

        promise().then(

            function(text) {

                console.log(text);

                if (bView !== undefined) bView.unshow();

            }

        );

    };

    var popView = function(_num) {

        var num = 1;

        if (_num !== undefined) num = _num;

        if (views.length - num < 1) {

            console.log("can't pop");

        } else {

            for (var i = 0; i < num; i++) {

                popOne();

            }

        }

    };

    var popViewToRoot = function() {

        if (views.length === 1) {

            console.log("Root No pop");

        } else {

            console.log("Root pop");

            // 전부다 삭제
            for (var i = 0; i < views.length; i++) popOne();

        }

    };

    var popOne = function() {

        views[views.length - 1].hide();
        views.pop();

    };

    var getCurrentView = function() {

        return views[views.length - 1];

    };

    var getBeforeView = function() {

            if(views.length < 2) return;
            else return views[views.length - 2];

    };

    return {
        pushView:pushView,
        popView:popView,
        popViewToRoot:popViewToRoot,
        getCurrentView:getCurrentView,
        getBeforeView:getBeforeView
    };

}());